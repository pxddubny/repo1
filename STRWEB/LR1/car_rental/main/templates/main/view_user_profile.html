{% extends "base.html" %}

{% block title %}User Profile - Car Rental{% endblock %}

{% block header %}User Profile: {{ viewed_user.username }}{% endblock %}

{% block content %}
<h2>User Information</h2>
<p><strong>Name:</strong> {{ viewed_user.first_name }} {{ viewed_user.middle_name }} {{ viewed_user.last_name }}</p>
<p><strong>Phone:</strong> {{ viewed_user.phone }}</p>
<p><strong>Birth Date:</strong> {{ viewed_user.birth_date|date:"d.m.Y" }}</p>
<p><strong>Address:</strong> {{ viewed_user.address }}</p>
<p><strong>Role:</strong> {{ viewed_user.get_role_display }}</p>

<h2>User Rentals</h2>
{% if rentals %}
<table>
    <tr>
        <th>ID</th>
        <th>Car</th>
        <th>Start Date</th>
        <th>Days</th>
        <th>Expected Return Date</th>
        <th>Amount</th>
        <th>Discount</th>
        <th>Status</th>
        <th>Change Status</th>
    </tr>
    {% for rental in rentals %}
    <tr>
        <td>{{ rental.id }}</td>
        <td>{{ rental.car }}</td>
        <td>{{ rental.start_date }}</td>
        <td>{{ rental.days }}</td>
        <td>{{ rental.expected_return_date|date:"d.m.Y" }}</td>
        <td>{{ rental.total_amount }} ₽</td>
        <td>{{ rental.discount_amount }} ₽</td>
        <td>{{ rental.get_status_display }}</td>
        <td>
            <form method="post" style="display: inline;">
                {% csrf_token %}
                <input type="hidden" name="rental_id" value="{{ rental.id }}">
                <select name="status" onchange="this.form.submit()">
                    {% for status_code, status_name in status_choices %}
                    <option value="{{ status_code }}" {% if rental.status == status_code %}selected{% endif %}>
                        {{ status_name }}
                    </option>
                    {% endfor %}
                </select>
            </form>
        </td>
    </tr>
    {% endfor %}
</table>
{% else %}
<p>The user has no rentals.</p>
{% endif %}

<p><a href="{% url 'clients_with_rentals' %}">Back to Client List</a></p>
{% endblock %}

{% block cat_fact %}{% endblock %}
{% block news %}{% endblock %}