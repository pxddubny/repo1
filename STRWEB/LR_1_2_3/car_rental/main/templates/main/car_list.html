{% extends "base.html" %}
{% load static %}

{% block title %}Car List - Car Rental{% endblock %}

{% block header %}Car List{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/car_list_pagination.css' %}">

<form method="get" id="car-search-form" class="search-form">
    <input type="text" name="search" placeholder="Search by license plate" value="{{ search_query }}">
    <button type="submit">Search</button>
    
    <!-- Добавляем скрытые поля для параметров пагинации -->
    <input type="hidden" name="items_per_page" value="{{ items_per_page }}">
    <input type="hidden" name="page" value="1">
</form>

<!-- Настройка количества элементов на странице (ВСЕГДА ПОКАЗЫВАЕМ) -->
<div class="items-per-page-selector">
    <label for="items-per-page-select">Items per page:</label>
    <select name="items_per_page" id="items-per-page-select">
        {% for option in items_per_page_options %}
            <option value="{{ option }}" {% if option|stringformat:"s" == items_per_page %}selected{% endif %}>
                {{ option }}
            </option>
        {% endfor %}
    </select>
    <span class="items-per-page-info">
        (Total: {{ paginator.count }} cars)
    </span>
</div>

<div class="cars-grid">
    {% if cars %}
        {% for car in cars %}
        <div class="car-card">
            <div class="car-license">{{ car.license_plate }}</div>
            <div class="car-model">{{ car.model }}</div>
            <div class="car-year">{{ car.year }}</div>
            <div class="car-price">${{ car.daily_rental_price }}/day</div>
            <div class="car-info">
                {% if car.pk %}
                <a href="{% url 'car_detail' car_id=car.pk %}" title="View car details">
                    View Details
                </a>
                {% else %}
                N/A
                {% endif %}
            </div>
        </div>
        {% endfor %}
    {% else %}
        <div class="empty-result">
            {% if search_query %}
                No cars found matching "{{ search_query }}"
            {% else %}
                No cars available
            {% endif %}
        </div>
    {% endif %}
</div>

<!-- Пагинация (показываем только если больше 1 страницы) -->
{% if page_obj.paginator.num_pages > 1 %}
<div class="pagination-container">
    <div class="pagination-info">
        Showing {{ page_obj.start_index }}-{{ page_obj.end_index }} of {{ paginator.count }} cars
        {% if search_query %}matching "{{ search_query }}"{% endif %}
        (Page {{ page_obj.number }} of {{ paginator.num_pages }})
    </div>
    
    <div class="pagination-controls">
        <div class="pagination-buttons">
            <!-- Кнопка "Первая" -->
            {% if page_obj.has_previous %}
            <button class="pagination-btn" data-page="1" title="First page">
                &laquo;&laquo;
            </button>
            <button class="pagination-btn" data-page="{{ page_obj.previous_page_number }}" title="Previous page">
                &laquo;
            </button>
            {% else %}
            <button class="pagination-btn" disabled>&laquo;&laquo;</button>
            <button class="pagination-btn" disabled>&laquo;</button>
            {% endif %}
        </div>
        
        <!-- Номера страниц -->
        <div class="page-numbers">
            {% for num in paginator.page_range %}
                {% if num == page_obj.number %}
                    <button class="pagination-btn active" disabled>{{ num }}</button>
                {% elif num >= page_obj.number|add:"-2" and num <= page_obj.number|add:"2" %}
                    <button class="pagination-btn" data-page="{{ num }}">{{ num }}</button>
                {% elif num == 1 or num == paginator.num_pages %}
                    <button class="pagination-btn" data-page="{{ num }}">{{ num }}</button>
                {% elif num == page_obj.number|add:"-3" or num == page_obj.number|add:"3" %}
                    <span class="pagination-dots">...</span>
                {% endif %}
            {% endfor %}
        </div>
        
        <div class="pagination-buttons">
            <!-- Кнопка "Вперед" -->
            {% if page_obj.has_next %}
            <button class="pagination-btn" data-page="{{ page_obj.next_page_number }}" title="Next page">
                &raquo;
            </button>
            <button class="pagination-btn" data-page="{{ paginator.num_pages }}" title="Last page">
                &raquo;&raquo;
            </button>
            {% else %}
            <button class="pagination-btn" disabled>&raquo;</button>
            <button class="pagination-btn" disabled>&raquo;&raquo;</button>
            {% endif %}
        </div>
    </div>
</div>
{% else %}
<!-- Если всего одна страница, показываем только информацию -->
<div class="pagination-info single-page">
    Showing all {{ paginator.count }} cars
    {% if search_query %}matching "{{ search_query }}"{% endif %}
</div>
{% endif %}

<script src="{% static 'js/car_list_pagination.js' %}"></script>
{% endblock %}

{% block cat_fact %}{% endblock %}
{% block news %}{% endblock %}