{% extends "base.html" %}
{% load static %}

{% block title %}Список сотрудников{% endblock %}

{% block content %}
<script src="{% static 'js/employee_list.js' %}?v=2.3"></script>
<link rel="stylesheet" href="{% static 'css/employee-list.css' %}">
<div class="employee-list-section">
  <h2>Список сотрудников</h2>

  <script>
    window.employeesData = {{ employees_data|safe }};
    console.log('Employees data loaded:', window.employeesData);
  </script>

  <!-- Кнопка для открытия формы добавления сотрудника -->
  <div class="form-toggle-container">
    <button id="add-employee-btn" class="btn">Добавить сотрудника</button>
    
    <!-- Выпадающая форма добавления сотрудника -->
    <div id="add-employee-dropdown" class="dropdown-form" style="display: none;">
      <div class="dropdown-content">
        <h3>Добавить нового сотрудника</h3>
        <form id="add-employee-form" method="POST" action="{% url 'add_employee' %}">
          {% csrf_token %}
          <div class="form-group">
            <label for="full_name">ФИО</label>
            <input type="text" id="full_name" name="name" required />
          </div>
          <div class="form-group">
            <label for="photo_url">Фото</label>
            <input type="text" id="photo_url" name="photo_path" />
          </div>
          <div class="form-group">
            <label for="job_description">Описание работ</label>
            <input type="text" id="job_description" name="description" required />
          </div>
          <div class="form-group">
            <label for="position">Должность</label>
            <input type="text" id="position" name="position" required />
          </div>
          <div class="form-group">
            <label for="phone">Телефон</label>
            <input type="text" id="phone" name="phone" required />
            <small class="input-error" id="phone_error"></small>
          </div>
          <div class="form-group">
            <label for="email">Почта</label>
            <input type="email" id="email" name="email" required />
          </div>
          <div class="form-group">
            <label for="link_url">Ссылка</label>
            <input type="url" id="link_url" name="link" required/>
            <small class="input-error" id="link_url_error"></small>
          </div>
          <div class="form-buttons">
            <button type="submit" class="btn" id="submit-employee-btn" disabled>Добавить</button>
            <button type="button" id="cancel-form-btn" class="btn btn-secondary">Отмена</button>
          </div>
          <div id="form-result" class="form-result"></div>
        </form>
      </div>
    </div>
  </div>

  <!-- Фильтрация -->
  <div class="filter-section">
    <input type="text" id="filter-input" placeholder="Введите для фильтрации..." />
    <button id="filter-btn" class="btn">Найти</button>
  </div>

  <!-- Таблица сотрудников -->
  <table id="employee-table">
    <thead>
      <tr>
        <th data-column="name">
          ФИО
          <span class="sort-indicator"></span>
        </th>
        <th data-column="photo_path">
          Фото
          <span class="sort-indicator"></span>
        </th>
        <th data-column="description">
          Описание работ
          <span class="sort-indicator"></span>
        </th>
        <th data-column="position">
          Должность
          <span class="sort-indicator"></span>
        </th>
        <th data-column="phone">
          Телефон
          <span class="sort-indicator"></span>
        </th>
        <th data-column="email">
          Почта
          <span class="sort-indicator"></span>
        </th>
        <th data-column="link">
          Ссылка
          <span class="sort-indicator"></span>
        </th>
        <th>Выбрать</th>
      </tr>
    </thead>
    <tbody>
      <!-- Данные будут загружены через JavaScript -->
    </tbody>
  </table>

  <!-- Пагинация -->
  <div class="pagination">
    <button id="prev-page" class="btn">Предыдущая</button>
    <span id="current-page">1</span>
    /
    <span id="total-pages">1</span>
    <button id="next-page" class="btn">Следующая</button>
  </div>

  <!-- Дополнительный блок для отображения деталей выбранного сотрудника -->
  <div id="employee-details" class="employee-details">
  </div>

  <!-- Кнопка для премирования выбранных сотрудников -->
  <button id="award-btn" class="btn">Премировать</button>

  <!-- Блок для отображения текста премирования -->
  <div id="award-text" class="award-text">
  </div>
</div>

<style>
/* Стили для выпадающей формы */
.form-toggle-container {
  position: relative;
  margin-bottom: 10px;
}

.dropdown-form {
  position: absolute;
  top: 100%;
  left: 0;
  margin-top: 10px;
  border: 1px solid #ddd;
  border-radius: 8px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  background: white;
  z-index: 1000;
  min-width: 400px;
}

.dropdown-content {
  padding: 20px;
}

.dropdown-content h3 {
  margin-top: 0;
  color: #333;
  border-bottom: 1px solid #eee;
  padding-bottom: 10px;
  margin-bottom: 20px;
}

.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
  color: #555;
}

.form-group input {
  width: 100%;
  padding: 8px 12px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 14px;
}

.form-group input:focus {
  outline: none;
  border-color: #4a90e2;
  box-shadow: 0 0 0 2px rgba(74, 144, 226, 0.2);
}

.form-buttons {
  display: flex;
  gap: 10px;
  margin-top: 20px;
}

.btn {
  padding: 10px 20px;
  background-color: #4a90e2;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 14px;
  transition: background-color 0.3s;
}

.btn:hover {
  background-color: #357ae8;
}

.btn-secondary {
  background-color: #6c757d;
}

.btn-secondary:hover {
  background-color: #5a6268;
}

#submit-employee-btn:disabled {
  background-color: #cccccc;
  cursor: not-allowed;
}

.input-error {
  color: #dc3545;
  font-size: 12px;
  margin-top: 5px;
  display: block;
}

.form-result {
  margin-top: 15px;
  padding: 10px;
  border-radius: 4px;
}

.form-result.success {
  background-color: #d4edda;
  color: #155724;
  border: 1px solid #c3e6cb;
}

.form-result.error {
  background-color: #f8d7da;
  color: #721c24;
  border: 1px solid #f5c6cb;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.dropdown-form {
  animation: slideDown 0.3s ease-out;
}

#add-employee-btn.active {
  background-color: #357ae8;
}
</style>
{% endblock %}